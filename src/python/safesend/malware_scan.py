import subprocess
import os

def scan_file(path):
    defender_path = "C:\\Program Files\\Windows Defender\\MpCmdRun.exe"
    if os.path.exists(defender_path):
        cmd = [defender_path, "-Scan", "-ScanType", "3", "-File", path]
        result = subprocess.run(cmd, capture_output=True, text=True)
        return result.returncode == 0, result.stdout + result.stderr
    else:
        # If Defender is not available, fallback to ClamAV
        return scan_with_clamav(path)

def scan_with_clamav(path):
    try:
        result = subprocess.run(['clamscan', path], capture_output=True, text=True)
        return result.returncode == 0, result.stdout + result.stderr
    except Exception as e:
        return False, str(e)
